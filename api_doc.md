# API Мастерской
##### Для роботов и для людей

## Архитектура API
```javascript
location: {
	 auth: {
	 	 id: ObjectId,
	 	 session: String
	 },
	 objects: {
		 id: ObjectId,
		 sort: String,
		 select: String,
		 skip: Number,
		 limit: Number,
		 interval_start: Number,
		 interval_end: Number,
		 populate: String
	 },
	 architects: {
		 id: ObjectId,
		 sort: String,
		 select: String,
		 skip: Number,
		 limit: Number,
		 interval_start: Number,
		 interval_end: Number
	 },
	 subjects: {
		 id: ObjectId,
		 sort: String,
		 select: String,
		 skip: Number,
		 limit: Number
	 }
}
```

## Принципы взаимодействия с API


Обращение к API происходит путем отправки GET запросов на адрес: http://virtual.muar.ru/api/v1/.
В случае успешного запроса, API возвращает ответ в формате JSON.
Участок адреса /v1/ характеризуют версию API к которой в данный момент идет обращение.


## Описание параметров API


Очередь параметров располагается в адресе за знаком '?'.
Параметры имеют вид param=value и разделяются знаком '&' если параметр может принимать несколько значений, все они разделяются знаком ','.
Порядок перечисления параметров значения не имеет.
Параметры имеющие неправильный формат не обрабатываются.

Формат запроса:

http://127.0.0.1:3000/api/v1/?param_1=value_1&param_2=value_2


## Авторизация


Для успешной авторизации необходимо отправить запрос на создание сессии с обязательным параметром id. В ответ API возвращает параметры secret и salt, на основе этих параметров необходимо сгенерировать пользовательский token, по формуле: token = floor(secret / salt). "целая часть от деления secret / salt".

Длительность установленной сессии составляет 1 час. По истечении этого времени необходимо заново сгенерировать token.


### Пример авторизации


1. Получить от администрации id = 5479bceade31d1cc7bac9a71

2. Отправить запрос на создание сессии:

http://127.0.0.1:3000/api/v1/?location=auth&id=5479bceade31d1cc7bac9a71&session=init

Ответ API:
```javascript
{
  "status": "ok",
  "location": "auth",
  "session": {
    "cookie": {
      "originalMaxAge": 3600000,
      "expires": "2014-11-29T15:40:47.510Z",
      "httpOnly": true,
      "path": "/"
    },
    "secret": 1417272047513,
    "salt": 202
  }
}
```
3. Сгенерировать token:

token = floor(1417272047513 / 202) --> 7016198255

4. Отправить запрос к API:

http://127.0.0.1:3000/api/v1/?location=objects&token=7016198255

5. Радоваться!


## Примеры запросов к API


###### Получить список объектов:
http://127.0.0.1:3000/api/v1/?location=objects&token=7016198255

######  Получить список объектов отсортированный по дате постройки в диапазоне выборки с 10 до 21:
http://127.0.0.1:3000/api/v1/?location=objects&sort=meta.interval.start,meta.interval.end&skip=10&limit=21&token=7016198255

######  Получить объект по его идентификатору с выполнением подстановки полей архитекторов:
http://127.0.0.1:3000/api/v1/?location=objects&id=546b527ebe5f5200007cb8d6&populate=architects&token=7016198255


## Параметры API

### Авторизация - location=auth
---

### id
- Статус - Обязательный
- Значение: ObjectId

> Идентификатор пользователя, необходимый для создания сессии.

### session
- Статус - Обязательный
- Тип значения: String
- Значения: init, status, destroy

> Позволяет управлять пользовательской сессией.


### Объекты - location=events
---


### token
- Статус - Обязательный
- Тип значения: Number

> Пользовательский ключ, необходимый для доступа к api

#### id
- Статус - Необязательный
- Тип значения: ObjectId

> Идентификатор объекта. Если идентификатор объекта не указан, API возвращает список всех объектов.

### sort
- Статус - Необязательный
- Тип значения: String
- Значение: result_field

> Сортирует выдачу по параметру или группе параметров, для обратной сортировки перед параметром ставится '-'. Допускается комбинация положительных и отрицательных значений.

### select
- Статус - Необязательный
- Тип значения: String
- Значение: result_field
- Значение по умолчанию: -__v,-_id

> Позволяет указать поля, которые войдут в ответ. Отрицательное значение каждого параметра исключает этот параметр из выдачи. Не допускается комбинация положительных и отрицательных значений.

### skip
- Статус - Необязательный
- Тип значения: Number
- Значение по умолчанию: 0

> Указывает число объектов, которое необходимо пропустить от начала выборки. Используется в комбинации с параметрами sort и limit и позволяет создавать диапазон выборки.

### limit
- Статус - Необязательный
- Тип значения: Number
- Значение по умолчанию: 10

>  Указывает максимальное число значений в выборке. Используется в комбинации с параметрами sort и skip и позволяет создавать диапазон выборки.

### populate
- Статус - Необязательный
- Тип значения: result_field

> Позволяет подставить значение в связанные поля выборки. Позволяет получить параметры архитекторов, единиц хранения и категорий для каждого объекта выборки.

### interval_start
- Статус - Необязательный
- Тип значения: Number

> Позволяет получить выборку в диапазоне дат каждого объекта, используется в комбинации с interval_end, в случае отсутствия параметра interval_end, оба параметра игнорируются. В случае присутствия параметра id, параметры interval_start и interval_end игнорируются.

### interval_end
- Статус - Необязательный
- Тип значения: Number

> Позволяет получить выборку в диапазоне дат каждого объекта, используется в комбинации с interval_start, в случае отсутствия параметра interval_start, оба параметра игнорируются. В случае присутствия параметра id, параметры interval_start и interval_end игнорируются.


### Архитекторы - location=architects
---


### token
- Статус - Обязательный
- Тип значения: Number

> Пользовательский ключ, необходимый для доступа к api

#### id
- Статус - Необязательный
- Тип значения: ObjectId

> Идентификатор архитектора. Если идентификатор архитектора не указан, API возвращает список всех архитекторов.

### sort
- Статус - Необязательный
- Тип значения: result_field

> Сортирует выдачу по параметру или группе параметров, для обратной сортировки перед параметром ставится '-'. Допускается комбинация положительных и отрицательных значений.

### select
- Статус - Необязательный
- Тип значения: result_field
- Значение по умолчанию: -__v,-_id

> Позволяет указать поля, которые войдут в ответ. Отрицательное значение каждого параметра исключает этот параметр из выдачи. Не допускается комбинация положительных и отрицательных значений.

### skip
- Статус - Необязательный
- Тип значения: Number
- Значение по умолчанию: 0

> Указывает число архитекторов, которое необходимо пропустить от начала выборки. Используется в комбинации с параметрами sort и limit и позволяет создавать диапазон выборки.

### limit
- Статус - Необязательный
- Тип значения: Number
- Значение по умолчанию: 10

> Указывает максимальное число значений в выборке. Используется в комбинации с параметрами sort и skip и позволяет создавать диапазон выборки.

### interval_start
- Статус - Необязательный
- Тип значения: Number

> Позволяет получить выборку в диапазоне дат каждого архитектора, используется в комбинации с interval_end, в случае отсутствия параметра interval_end, оба параметра игнорируются. В случае присутствия параметра id, параметры interval_start и interval_end игнорируются.

### interval_end
- Статус - Необязательный
- Тип значения: Number

> Позволяет получить выборку в диапазоне дат каждого архитектора, используется в комбинации с interval_start, в случае отсутствия параметра interval_start, оба параметра игнорируются. В случае присутствия параметра id, параметры interval_start и interval_end игнорируются.


### Единицы хранения - location=subjects
---


### token
- Статус - Обязательный
- Тип значение: Number

> Пользовательский ключ, необходимый для доступа к api

### id
- Статус - Необязательный
- Тип значения: ObjectId

> Идентификатор единицы хранения. Если идентификатор единицы хранения не указан, API возвращает список всех единиц хранения.

### sort
- Статус - Необязательный
- Тип значения: String
- Значение: result_field

> Сортирует выдачу по параметру или группе параметров, для обратной сортировки перед параметром ставится '-'. Допускается комбинация положительных и отрицательных значений.

### select
- Статус - Необязательный
- Тип значения: String
- Значение: result_field
- Значение по умолчанию: -__v,-_id

> Позволяет указать поля, которые войдут в ответ. Отрицательное значение каждого параметра исключает этот параметр из выдачи. Не допускается комбинация положительных и отрицательных значений.

### skip
- Статус - Необязательный
- Тип значения: Number
- Значение по умолчанию: 0

> Указывает число единиц хранения, которое необходимо пропустить от начала выборки. Используется в комбинации с параметрами sort и limit и позволяет создавать диапазон выборки.

### limit
- Статус - Необязательный
- Тип значения: Number
- Значение по умолчанию: 10

> Указывает максимальное число значений в выборке. Используется в комбинации с параметрами sort и skip и позволяет создавать диапазон выборки.


## Коды ошибок

##### 101
Param ID not found

##### 102
Param SESSION not found

##### 103
Permission denied

##### 23
Wrong location

##### 24
Incorrect id

##### 26
Bad token